"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},frame_rate_1=require("./models/frame-rate"),render_engine_1=require("./services/render-engine"),event_system_1=require("./services/event-system"),array_utils_1=require("./util/array-utils"),Game=function(){function t(t){this.PHYSICS_TIME_STEP=1/120,this.PHYSICS_VELOCITY_ITERATIONS=8,this.PHYSICS_POSITION_ITERATIONS=3,this.viewPortWidth=0,this.viewPortHeight=0,this.physicsDeltaAccumulator=0,this.canvas=t,this.viewPortWidth=t.width,this.viewPortHeight=t.height;var e=t.getContext("2d");if(null==e)throw new Error("Could not get the context from the canvas");this.context=e,this.gameObjects=[],this.inputControllers=[],this.running=!1,this.gravity=new PhysicsType2d.Vector2(0,0),this.physicsWorld=new PhysicsType2d.Dynamics.World(this.gravity),this.physicsWorld.SetContactListener(new CollisionHandler)}return t.prototype.start=function(){this.running=!0,this.update(),this.inputControllers.forEach(function(t){return t.bind()})},t.prototype.showFrameRate=function(t){t?(this.frameRateOverlay=new frame_rate_1.default,this.add(this.frameRateOverlay)):this.frameRateOverlay.alive=!1},t.prototype.setBounds=function(t,e){this.viewPortWidth=t,this.viewPortHeight=e,this.canvas.width=t,this.canvas.height=e,this.redraw()},t.prototype.stop=function(){this.running=!1,this.currentFrame=0,this.inputControllers.forEach(function(t){return t.unbind()})},t.prototype.add=function(t){t.attach(this),this.gameObjects.push(t)},t.prototype.remove=function(t){var e=this.gameObjects.indexOf(t);e!=-1&&(this.gameObjects.splice(e,1),t.detach(this))},t.prototype.addInput=function(t){this.inputControllers.push(t),this.running&&t.bind()},t.prototype.removeAllGameObjects=function(){for(var t=this.gameObjects.length-1;t>=0;t--)this.remove(this.gameObjects[t])},t.prototype.redraw=function(){render_engine_1.default.render(this.context,this.gameObjects,this)},t.prototype.update=function(t){var e=this;void 0===t&&(t=0);var i=0;t>0&&this.currentFrame>0&&(i=t-this.currentFrame),this.currentFrame=t;for(var r=this.gameObjects.length-1;r>=0;r--)this.gameObjects[r].alive||this.remove(this.gameObjects[r]);for(event_system_1.default.handleEvents(this),this.gameObjects.forEach(function(t){return t.update(i)}),this.redraw(),this.physicsDeltaAccumulator+=i;this.physicsDeltaAccumulator>1e3*this.PHYSICS_TIME_STEP;)this.physicsStep(),this.physicsDeltaAccumulator-=1e3*this.PHYSICS_TIME_STEP;this.running&&window.requestAnimationFrame(function(t){return e.update(t)})},t.prototype.physicsStep=function(){this.physicsWorld.Step(this.PHYSICS_TIME_STEP,this.PHYSICS_VELOCITY_ITERATIONS,this.PHYSICS_POSITION_ITERATIONS)},t.prototype.getViewPortWidth=function(){return this.viewPortWidth},t.prototype.getViewPortHeight=function(){return this.viewPortHeight},t.prototype.getInputController=function(t){return array_utils_1.default.getByType(t,this.inputControllers)},t.prototype.createPhysicsBody=function(t){return this.physicsWorld.CreateBody(t)},t.prototype.destroyPhysicBody=function(t){this.physicsWorld.DestroyBody(t)},t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Game;var CollisionHandler=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.BeginContact=function(e){t.prototype.BeginContact.call(this,e);var i=e.GetFixtureA().GetBody().GetUserData(),r=e.GetFixtureB().GetBody().GetUserData();void 0!=i&&void 0!=r&&(i.onContact(r),r.onContact(i))},e}(PhysicsType2d.Dynamics.ContactListener);
//# sourceMappingURL=game.js.map
